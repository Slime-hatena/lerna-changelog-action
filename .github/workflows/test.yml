name: 'build-test'
on: # rebuild any PRs and main branch changes
    pull_request:
    push:
        branches:
            - main
            - develop
            - 'releases/*'

jobs:
    build: # make sure build/ci work properly
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
              with:
                  fetch-depth: 0
            - run: echo '${{ secrets.GITHUB_TOKEN }}' > ./.GITHUB_AUTH
            - run: yarn install --frozen-lockfile
            - run: yarn run all
    test: # make sure the action works on a clean machine without building
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - uses: ./
              with:
                  milliseconds: 1000
